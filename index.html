<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather</title>

    <!--API KEY: 135f15ba9e1e49d3a64160722231710  -->
    <!--API URL: https://www.weatherapi.com/my/ -->


    <link rel="stylesheet" href="style.css">
    <script defer src="script.js"></script> <!--defer makes it execute after body-->

</head>

<body>
    <!--current-card is for current weather-->
    <div class = "current-card">

        <div class="search">
            <input type = "text" placeholder = "enter city name" spellcheck = "false"> <!--Search bar-->
            <button><img src="images2/search.png"></button> <!--search button-->
        </div>

        <div class="weather">
            <img id = "icon" src="images2/clear.png" class = "weather-icon"> <!--Current Weather image-->
            <h2 class="city">Location</h2>   <!--Current Weather location-->
            <p class="region">Region</p> <!---->
            <h1 class="temp">0°C</h1>    <!--Current weather temperature-->
            <h3 class="feel">Feels like 0°</h3>    <!--Feels like temperature-->
            <h3 class="condition">Condition</h3>  <!--Current Condition-->
            <div class = "HL">
                <p class="H">H:0°</p>
                <p class="L">L:0°</p>
            </div>
        </div>
    </div>

    <div class="card-row">

        <div class="hourly-card">
            <p class="card-title">HOURLY FORECAST</p>
            <br>
            <hr>
            <br>

            <div class="hourly-weather">
            </div>
        </div>

        <div class="square-card">
            <p class="card-title">HUMIDITY</p>
            <br>
            <hr>
            <br>
            <p class="humidity">0%</p>
            <img src="images2/humidity.png">
        </div>

        <div class="square-card">
            <p class="card-title">PRECIPITATION</p>
            <br>
            <hr>
            <br>
            <p class="precipitation">0 mm</p>
            <p>Today</p>
            <p class="future-precipitation">0 mm expected tomorrow.</p>

        </div>

        

    </div>

    <div class="card-row">

        <div class="square-card">
            <p class="card-title">WIND</p>
            <br>
            <hr>
            <br>
            <p class="wind">0 km/h</p>
            <img src="images2/wind.png">
            <p class = windDirection></p>
        </div>

        <div class="square-card">
            <p class="card-title">SUNRISE</p>
            <br>
            <hr>
            <br>
            <p class="sunrise">0:00 PM</p>
            <img src="images2/sunrise.png">
        </div>

        <div class="square-card">
            <p class="card-title">SUNSET</p>
            <br>
            <hr>
            <br>
            <p class="sunset">0:00 AM</p>
            <img src="images2/sunset.png">
        </div>

        <div class="square-card">
            <p class="card-title">VISIBILITY</p>
            <br>
            <hr>
            <br>
            <p class="visibility">0 km</p>
        </div>

        <div class="square-card">
            <p class="card-title">UV INDEX</p>
            <br>
            <hr>
            <br>
            <p class = uvIndex></p>
            <p class = uvDesc></p>
        </div>

        <div class="square-card">
            <p class="card-title">PRESSURE</p>
            <br>
            <hr>
            <br>
            <p class="pressure">0 hPa</p>

        </div>

    </div>

    <div class="card-row">

        <div class="daily-card">
            <p class="card-title">3-DAY FORECAST</p>
            <br>
            <hr>
            <br>
        </div>

        <div class="airQual-card">
            <p class="card-title">AIR QUALITY</p>
            <br>
            <hr>
            <br>
            <p class="airQual"></p>
            <br>
            <p class="airDesc"></p>
            <br>
            <p class="airNote"></p>
        </div>

        


    </div>
    <br>

    

    

<script>
    const apiURL = "https://api.weatherapi.com/v1/";
    const forecast = "forecast.json?";
    const key = "key=135f15ba9e1e49d3a64160722231710&q=";
    const days = "&days=3";
    const airQual = "&aqi=yes";
    const airData = "&agi=yes";
    const alerts = "&alerts=yes";


    const searchBox = document.querySelector(".search input");
    const searchBtn = document.querySelector(".search button");


    async function checkWeather(city){

        /*fetch 3 day weather data*/
        const response = await fetch(apiURL + forecast + key + city + days + airQual + alerts);
        var data = await response.json();

        console.log(data);

        /*Put current weather data into website elements*/
        document.getElementById("icon").src= data.current.condition.icon;
        document.querySelector(".city").innerHTML = data.location.name;
        document.querySelector(".region").innerHTML = data.location.region +" "+data.location.country;
        document.querySelector(".temp").innerHTML = Math.round(data.current.temp_c) + "°C";
        document.querySelector(".feel").innerHTML = "Feels like " + Math.round(data.current.feelslike_c) + "°";
        document.querySelector(".condition").innerHTML = data.current.condition.text;
        document.querySelector(".H").innerHTML = "H:"+Math.round(data.forecast.forecastday[0].day.maxtemp_c) + "°";
        document.querySelector(".L").innerHTML = "L:"+Math.round(data.forecast.forecastday[0].day.mintemp_c) + "°";
        document.querySelector(".humidity").innerHTML = data.current.humidity + "%";
        document.querySelector(".wind").innerHTML = data.current.wind_kph + " km/h";
        document.querySelector(".sunrise").innerHTML = data.forecast.forecastday[0].astro.sunrise.replace(/^0+/,""); /*Remove begining 0's with replace(regex)*/
        document.querySelector(".sunset").innerHTML = data.forecast.forecastday[0].astro.sunset.replace(/^0+/,""); /*Remove begining 0's with replace(regex)*/
        document.querySelector(".visibility").innerHTML = data.current.vis_km + " km";
        document.querySelector(".precipitation").innerHTML = Math.round(data.forecast.forecastday[0].day.totalprecip_mm) + " mm";
        document.querySelector(".future-precipitation").innerHTML = Math.round(data.forecast.forecastday[1].day.totalprecip_mm) + " mm expected tomorrow.";
        document.querySelector(".pressure").innerHTML = data.current.pressure_mb+" hPa"; 


        buildUVData();
        
        checkForAirQuality();

        //Save the sunset time, Used for hourly
        let sunsetTime = data.forecast.forecastday[0].astro.sunset.replace(/^0+/,"");//format is something like "5:51 PM"
        const array = sunsetTime.split(":"); 
        let sunsetHour = Number(array[0]);   //Take hour portion
        let rightPortion = array[1];  //Something like "32 PM"
        const array1 = rightPortion.split(" ");
        let sunsetMin = array1[0];   //left part is minute
        let amPM = array1[1];        //right part is AM/PM
        
        //Check if AM or PM
        if (amPM == "PM"){
            sunsetHour = sunsetHour + 12;  //convert to 24 hour time
        }

        //Save the sunrise time
        let sunriseTime = data.forecast.forecastday[0].astro.sunrise;
        const array2 = sunriseTime.split(" ");  
        sunriseTime = array2[0];    //remove the AM/PM portion will now look like "05:21"
        //get the sunrise hour
        const array3 = sunriseTime.split(":")
        let sunriseHour = array3[0].replace(/^0+/,""); // looks like "5"


        removeOldHourlyData();
    

        //get the current Hour of the city (used in houly forecast)
        let cityTime = data.current.last_updated.substring(11, 13); //take the time date time from datapack and cut the hour portion
        cityTime = cityTime.split(" ").join("");  //remove white spaces from string
        let theTime = cityTime.replace(/^0+/,"");   //remove any leading 0's from the hour portion
        let theHour = Number(theTime);      //convert the string into a number
        theHour = theHour + 1;   //Adding plus 1 to the hour (because we want to start hourly on the next hour)

        //Added current temp as first entry into houlry-weather
        document.querySelector(".hourly-weather").innerHTML +=  
            '<div class="hour">'+
                '<p class=hourNum> Now </p>'+                                                      
                '<img id = "hourIcon" src='+ data.current.condition.icon +'>'+                                             
                '<p>'+Math.round(data.current.temp_c) +'°</p>'+                                             
            '</div>';
        
        let currentDay = 0;
        let counter = 0;

        while (counter < 24)
        {
            //Need this incase the current hour of a city is on (theHour = 23) + 1  = 24
            //Need to increment the day and hour, otherwise it won't have the chance to change the day, result in error
            if(theHour == 24){
                currentDay = 1;
                theHour = 0;
            }

            let newHour;  //variable used for output purposes and not for calculations
            if(theHour.toString().length ==  1){
                newHour = theHour.toString().padStart(2, '0');  //convert single digit hour to double digit hours before outputting
            }
            else{
                newHour = theHour%24;
            }

            //Fill next hourly slot with information
            document.querySelector(".hourly-weather").innerHTML +=  
            '<div class="hour">'+
                '<p class=hourNum>'+newHour+'</p>'+                                             
                '<img id = "hourIcon" src='+ data.forecast.forecastday[currentDay].hour[theHour].condition.icon +'>'+                                     
                '<p>'+Math.round(data.forecast.forecastday[currentDay].hour[theHour].temp_c) +'°</p>'+                                                  
            '</div>';

            if (theHour == 23){
                currentDay = 1;
                theHour = -1;
            }
            
            //Check if the next entry should be a sunset entry
            if(theHour == sunsetHour){
                //insert the sunset slot now
                document.querySelector(".hourly-weather").innerHTML +=  
                '<div class="hour">'+
                    '<p class=hourNum>'+sunsetHour+':'+sunsetMin+'</p>'+                                                      
                    '<img id = "hourIcon" src=images2/sunset.png>'+                                             
                    '<p>Sunset</p>'+                                             
                '</div>';
            }
            //check if next extry should be sunrise time
            if(theHour == sunriseHour){
                //insert the sunrise slot now
                document.querySelector(".hourly-weather").innerHTML +=  
                '<div class="hour">'+
                    '<p class=hourNum>'+sunriseTime+'</p>'+                                                      
                    '<img id = "hourIcon" src=images2/sunrise.png>'+                                             
                    '<p>Sunrise</p>'+                                             
                '</div>';
            }
            theHour = theHour + 1;
            counter = counter + 1;
        }
        


        removeOldThreeDayData();

        buildThreeDayWidget();
       

        
        







        /*document.getElementById("hourIcon").src = data.forecast.forecastday[0].hour[i].condition.icon;*/
        /*https://9to5mac.com/2023/01/08/macos-ventura-weather-app/*/




        /**********Functions**********/


        function buildUVData()
        {
            //Get UV-index place into its widget
            document.querySelector(".uvIndex").innerHTML = data.current.uv;
            let uvDescription;
            if(data.current.uv > 10){
                uvDescription = "Extreme";
            }
            else if(data.current.uv > 7){
                uvDescription = "Very High";
            }
            else if(data.current.uv > 5){
                uvDescription = "High";
            }
            else if(data.current.uv > 2){
                uvDescription = "Moderate";
            }
            else{
                uvDescription = "Low";
            }
            document.querySelector(".uvDesc").innerHTML = uvDescription;

        }




        function checkForAirQuality(){
            if(data.hasOwnProperty("air_quality"))
            {
                let airQualWord;
                if(data.forecast.forecastday[0].day.air_quality.aqi_data == "null"){
                    document.querySelector(".airQual").innerHTML = "Air Quality inforation is currently not available for this location";
                } 
                else{
                    switch(data.forecast.forecastday[0].day.air_quality["us-epa-index"]){
                        case 1:
                            airQualWord = "Good";
                            break;
                        case 2:
                            airQualWord = "Moderate";
                            break;
                        case 3:
                            airQualWord = "Unhealthy for sensitive people";
                            break;
                        case 4:
                            airQualWord = "Unhealthy";
                            break;
                        case 5:
                            airQualWord = "Very Unhealthy";
                            break;
                        case 6:
                            airQualWord = "Hazardous";
                            break;
                        default:
                            airQualWord = "No info";
                    }
                    document.querySelector(".airQual").innerHTML = data.forecast.forecastday[0].day.air_quality["us-epa-index"];
                    document.querySelector(".airDesc").innerHTML = airQualWord;
                    document.querySelector(".airNote").innerHTML = "Based on US EPA Standard";
                }
            }
            else{
                console.log("Air quality object not found in the JSON");
                document.querySelector(".airQual").innerHTML = "Air Quality inforation is currently not available at this time";
            }
            /*Based on the US - EPA standard
            1 means Good (Green)
            2 means Moderate (Yellow)
            3 means Unhealthy for sensitive group (Orange)
            4 means Unhealthy (Red)
            5 means Very Unhealthy (Purple)
            6 means Hazardous (Maroon) */
        }



        function removeOldHourlyData(){
            /*Remove the old houly data, if there is one from a previous search*/
            const elements = document.getElementsByClassName("hour");
            while(elements.length > 0){
                elements[0].parentNode.removeChild(elements[0]);
            }
        }

        function removeOldThreeDayData(){
            /*Remove the old houly data, if there is one from a previous search*/
            const elements = document.getElementsByClassName("daily-weather");
            while(elements.length > 0){
                elements[0].parentNode.removeChild(elements[0]);
            }
        }

        function buildThreeDayWidget()
        {
            const weekday = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
            //create a date object using the date string value from json
            //Need to change from 2023-10-31 to 2023/10/31 to get correct date for some reason (might be javascript glitch or inconsistency)
            let dt = new Date(data.forecast.forecastday[0].date.replace(/-/g, '\/'));  

            document.querySelector(".daily-card").innerHTML += '<div class = "daily-weather"></div>';

            dayCounter = 0;
            let theDay;
            while(dayCounter < 3)
            {
                //Check if it's the first day, if so, set text to "Today"
                if(dayCounter == 0){
                    theDay = "Today";
                }
                else{
                    theDay = weekday[dt.getDay() + dayCounter];
                }

                document.querySelector(".daily-weather").innerHTML +=  
                    '<div class="dayWeather">'+
                        '<p>'+theDay+'</p>'+
                        '<img src='+data.forecast.forecastday[0].day.condition.icon+'>'+        
                        '<p class="daylow">L: '+Math.round(data.forecast.forecastday[dayCounter].day.mintemp_c)+'°</p>'+                                       
                        '<p class="dayhigh">H: '+Math.round(data.forecast.forecastday[dayCounter].day.maxtemp_c)+'°</p>'+
                        '<p class="daypop">POP: '+data.forecast.forecastday[dayCounter].day.daily_chance_of_rain+'%</p>'+                                             
                    '</div>';
                
                //Make sure the last row does not print a horizontal rule <hr>
                if(dayCounter != 2){
                    document.querySelector(".daily-weather").innerHTML +=  '<hr><br>';
                }
                //Increment day counter
                dayCounter = dayCounter + 1;
            }
        }









    }

    /*Event listener for clicking search button*/
    searchBtn.addEventListener("click", ()=>{
        checkWeather(searchBox.value);
    })

    /*Event listener for pressing the enter key*/
    searchBox.addEventListener("keypress", ()=>{
        if(event.key === "Enter"){
            checkWeather(searchBox.value);
        }
    })









</script>



</body>
</html>


<!--

Previous method storing data from json to arrays

    /*Instead of storing in array store each as an object*/
        /*try to store hourly temp data into a list */
        /*
        let dayOneTemps=[];
        for (let i = 0 ; i < 24 ; i++){
            dayOneTemps.push(data.forecast.forecastday[0].hour[i].temp_c) ;
        }

        let dayTwoTemps=[];
        for (let i = 0 ; i < 24 ; i++){
            dayTwoTemps.push(data.forecast.forecastday[1].hour[i].temp_c) ;
        }
        */
        /*Combine both arrays*/
        /*
        let _48HourTemps = dayOneTemps.concat(dayTwoTemps);
        */

        /*display the array*/
        /*document.getElementById("root").innerHTML = _48HourTemps.length; */









-->