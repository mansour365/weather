<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather</title>

    <!--Notable things acheived-->
    <!--CSS Grid-->
    <!--weather API (rest api or api?)-->


    <!--API KEY: 135f15ba9e1e49d3a64160722231710  -->
    <!--API URL: https://www.weatherapi.com/my/ -->


    <link rel="stylesheet" href="style.css">
    <script defer src="script.js"></script> <!--defer makes it execute after body-->

</head>

<body>
    <!--current-card is for current weather-->
    <div class = "current-card">

        <div class="search">
            <input type = "text" placeholder = "enter city name" spellcheck = "false"> <!--Search bar-->
            <button><img src="images2/search.png"></button> <!--search button-->
        </div>

        <div class="weather">
            <img id = "icon" src="images2/clear.png" class = "weather-icon"> <!--Current Weather image-->
            <h2 class="city">Location</h2>   <!--Current Weather location-->
            <p class="region">Region</p> <!---->
            <h1 class="temp">0°C</h1>    <!--Current weather temperature-->
            <h3 class="feel">Feels like 0°</h3>    <!--Feels like temperature-->
            <h3 class="condition">Condition</h3>  <!--Current Condition-->
            <div class = "HL">
                <p class="H">H:0°</p>
                <p class="L">L:0°</p>
            </div>
        </div>
    </div>

    <div class="my-grid">

        <div class="hourly-card">
            <div class = "full-title">
                <img class = "icon" src="icons/clock.png">
                <p class="card-title">HOURLY FORECAST</p>
            </div>
            <br>
            <hr>
            <br>
            <div class="hourly-weather">
            </div>
        </div>

        <div class="square-card">
            <div class = "full-title">
                <img class = "icon" src="icons/humidity.png">
                <p class="card-title">HUMIDITY</p>
            </div>
            <br>
            <p class="humidity">0%</p>
            <p class = "dewpoint">The dew point is 0° <br />right now.</p>
        </div>

        <div class="square-card">
            <div class = "full-title">
                <img class = "icon" src="icons/precipitation.png">
                <p class="card-title">PRECIPITATION</p>
            </div>
            <br>
            <p class="precipitation">0 mm</p>
            <p class="precipitation-desc">Today</p>
            <p class="future-precipitation">0 mm expected <br /> tomorrow.</p>
        </div>

        <div class="daily-card">
            <div class = "full-title">
                <img class = "icon" src="icons/calendar.png">
                <p class="card-title">3-DAY FORECAST</p>
            </div>
            <br>
            <hr>
            <br>
            <div class = "daily-weather">
                <div class="dayWeather">
                    <div class = "dailycol1">
                        <p class="theDay">Today</p>
                        <img src="images2/clear.png">
                    </div>
                    <div class = "dailycol2">  
                        <p class="dayhigh">H: 5°</p>    
                        <p class="daylow">L: 0°</p>   
                    </div>   
                    <div class = "dailycol3">                                  
                        <p class="daypop">POP: 0%</p> 
                        <p class="dayprecip">0 mm</p> 
                    </div>                                          
                </div>
                <p class = daily-condition>Moderate or heavy showers of ice pellets</p>

            </div>
        </div>

        <div class="airQual-card">
            <div class = "full-title">
                <img class = "icon" src="icons/airQual.png">
                <p class="card-title">AIR QUALITY</p>
            </div>
            <br>
            <p class="airDesc">Good</p>
            <br>
            <p class="airNote">Based on US EPA Standard</p>
            <img src="images2/aqi line.png">
        </div>

        <div class="square-card">
            <div class = "full-title">
                <img class = "icon" src="icons/wind.png">
                <p class="card-title">WIND</p>
            </div>
            <br>
            <p class="wind">0 km/h</p>
            <p class = "windDirection">Direction: N</p>
            <p class = windGust>With wind gusts of <br /> 0 km/h.</p>
        </div>

        <div class="square-card">
            <div class = "full-title">
                <img class = "icon" src="icons/sun-icon.png">
                <p class="card-title">UV INDEX</p>
            </div>
            <br>
            <p class = uvIndex>0</p>
            <p class = uvDesc>Low</p>
            <img class="uvimg" src = "images2/uv-line.png">
        </div>

        <div class="square-card">
            <div class = "full-title">
                <img class = "icon" src="icons/sunrise.png">
                <p class="card-title">SUNRISE</p>
            </div>
            <br>
            <p class="sunrise">00:00</p>
            <img class = sunrise-img src="images2/sunrise.png">
        </div>

        <div class="square-card">
            <div class = "full-title">
                <img class = "icon" src="icons/sunset.png">
                <p class="card-title">SUNSET</p>
            </div>
            <br>
            <p class="sunset">00:00</p>
            <img class = "sunset-img" src="images2/sunset.png">
        </div>

        <div class="square-card">
            <div class = "full-title">
                <img class = "icon" src="icons/visibility.png">
                <p class="card-title">VISIBILITY</p>
            </div> 
            <br>
            <p class="visibility">0 km</p>
            <p class="visible-note">Poor visbility</p>
        </div>

        <div class="square-card">
            <div class = "full-title">
                <img class = "icon" src="icons/pressure.png">
                <p class="card-title">PRESSURE</p>
            </div>
            <br>
            <p class="pressure">0 hPa</p>
        </div>

    </div>
    <br>
    <br>

    

    

<script>
    const apiURL = "https://api.weatherapi.com/v1/";
    const forecast = "forecast.json?";
    const key = "key=135f15ba9e1e49d3a64160722231710&q=";
    const days = "&days=3";
    const airQual = "&aqi=yes";
    const alerts = "&alerts=yes";

    const searchBox = document.querySelector(".search input");
    const searchBtn = document.querySelector(".search button");


    async function checkWeather(city){

        /*fetch 3 day weather data*/
        const response = await fetch(apiURL + forecast + key + city + days + airQual + alerts);
        var data = await response.json();

        console.log(data);

        /*Put current weather data into website elements*/
        document.getElementById("icon").src= data.current.condition.icon;
        document.querySelector(".city").innerHTML = data.location.name;
        document.querySelector(".region").innerHTML = data.location.region +" "+data.location.country;
        document.querySelector(".temp").innerHTML = Math.round(data.current.temp_c) + "°C";
        document.querySelector(".feel").innerHTML = "Feels like " + Math.round(data.current.feelslike_c) + "°";
        document.querySelector(".condition").innerHTML = data.current.condition.text;
        document.querySelector(".H").innerHTML = "H:"+Math.round(data.forecast.forecastday[0].day.maxtemp_c) + "°";
        document.querySelector(".L").innerHTML = "L:"+Math.round(data.forecast.forecastday[0].day.mintemp_c) + "°";

        document.querySelector(".humidity").innerHTML = data.current.humidity + "%";
        
        document.querySelector(".wind").innerHTML = Math.round(data.current.wind_kph) + " km/h";
        document.querySelector(".windDirection").innerHTML = "Direction: "+data.current.wind_dir;
        document.querySelector(".windGust").innerHTML = " With wind gusts of <br />"+Math.round(data.current.gust_kph)+" km/h.";
        document.querySelector(".visibility").innerHTML = data.current.vis_km + " km";
        document.querySelector(".precipitation").innerHTML = Math.round(data.forecast.forecastday[0].day.totalprecip_mm) + " mm";
        document.querySelector(".future-precipitation").innerHTML = Math.round(data.forecast.forecastday[1].day.totalprecip_mm) + " mm expected <br /> tomorrow.";
        document.querySelector(".pressure").innerHTML = data.current.pressure_mb+" hPa"; 


        buildUVWidget();
        
        checkForAirQuality();

        //Save the sunset time, Used for hourly
        let sunsetT = data.forecast.forecastday[0].astro.sunset.replace(/^0+/,"");//format is something like "5:51 PM"
        const array = sunsetT.split(":"); 
        let sunsetHour = Number(array[0]);   //Take hour portion (sunsetHour is used by others)
        let rightPortion = array[1];  //Something like "32 PM"
        const array1 = rightPortion.split(" ");
        let sunsetMin = array1[0];   //left part is minute
        let amPM = array1[1];        //right part is AM/PM

        //Check if AM or PM
        if (amPM == "PM"){
            sunsetHour = sunsetHour + 12;  //convert to 24 hour time
        }
        let sunsetTime = sunsetHour+":"+sunsetMin; //sunsetTime is used by others


        

        let sunriseTime = getSunriseTime();

        let sunriseHour = getSunriseHour(sunriseTime);
        

        removeOldHourlyData();
    

        //get the current Hour of the city (used in houly forecast)
        let cityTime = data.current.last_updated.substring(11, 13); //take the time date time from datapack and cut the hour portion
        cityTime = cityTime.split(" ").join("");  //remove white spaces from string
        let theTime = cityTime.replace(/^0+/,"");   //remove any leading 0's from the hour portion
        let theHour = Number(theTime);      //convert the string into a number
        theHour = theHour + 1;   //Adding plus 1 to the hour (because we want to start hourly on the next hour)
        let dewpointHour = theHour - 1;

        //Get dew point data (It needs the current Hour)
        document.querySelector(".dewpoint").innerHTML = 'The dew point is '+Math.round(data.forecast.forecastday[0].hour[dewpointHour].dewpoint_c)+'° <br />right now.';


        //Added current temp as first entry into houlry-weather
        document.querySelector(".hourly-weather").innerHTML +=  
            '<div class="hour">'+
                '<p class=hourNum> Now </p>'+                                                      
                '<img id = "hourIcon" src='+ data.current.condition.icon +'>'+                                             
                '<p>'+Math.round(data.current.temp_c) +'°</p>'+                                             
            '</div>';
        
        let currentDay = 0;
        let counter = 0;

        while (counter < 24)
        {
            //Need this incase the current hour of a city is on (theHour = 23) + 1  = 24
            //Need to increment the day and hour, otherwise it won't have the chance to change the day, result in error
            if(theHour == 24){
                currentDay = 1;
                theHour = 0;
            }

            let newHour;  //variable used for output purposes and not for calculations
            if(theHour.toString().length ==  1){
                newHour = theHour.toString().padStart(2, '0');  //convert single digit hour to double digit hours before outputting
            }
            else{
                newHour = theHour%24;
            }

            //Fill next hourly slot with information
            document.querySelector(".hourly-weather").innerHTML +=  
            '<div class="hour">'+
                '<p class=hourNum>'+newHour+'</p>'+                                             
                '<img id = "hourIcon" src='+ data.forecast.forecastday[currentDay].hour[theHour].condition.icon +'>'+                                     
                '<p>'+Math.round(data.forecast.forecastday[currentDay].hour[theHour].temp_c) +'°</p>'+                                                  
            '</div>';

            if (theHour == 23){
                currentDay = 1;
                theHour = -1;
            }
            
            //Check if the next entry should be a sunset entry
            if(theHour == sunsetHour){
                //insert the sunset slot now
                document.querySelector(".hourly-weather").innerHTML +=  
                '<div class="hour">'+
                    '<p class=hourNum>'+sunsetTime+'</p>'+                                                      
                    '<img id = "hourIcon" src=images2/sunset.png>'+                                             
                    '<p>Sunset</p>'+                                             
                '</div>';
            }
            //check if next extry should be sunrise time
            if(theHour == sunriseHour){
                //insert the sunrise slot now
                document.querySelector(".hourly-weather").innerHTML +=  
                '<div class="hour">'+
                    '<p class=hourNum>'+sunriseTime+'</p>'+                                                      
                    '<img id = "hourIcon" src=images2/sunrise.png>'+                                             
                    '<p>Sunrise</p>'+                                             
                '</div>';
            }
            theHour = theHour + 1;
            counter = counter + 1;
        }
        


        removeOldThreeDayData();

        buildThreeDayWidget();

        buildSunriseWidget();

        buildSunsetWidget();

        buildVisibilityWidget();

        
       

        
       

    

        //document.getElementById("hourIcon").src = data.forecast.forecastday[0].hour[i].condition.icon;
        //https://9to5mac.com/2023/01/08/macos-ventura-weather-app/
        //https://media.idownloadblog.com/wp-content/uploads/2021/07/Air-quality-index.jpeg
        //https://discuss.tidbyt.com/uploads/db2982/original/2X/a/aac34789ec36960b097645564653eb35b7a4413f.jpeg
        //Source for visbility
        //https://www.semanticscholar.org/paper/Analysis-of-the-atmospheric-visibility-Restoration-Deshpande/662237bb893d2b50a728751880f20cf1f8225aef



        /**********Functions**********/


        function buildUVWidget()
        {
            //Get UV-index place into its widget
            document.querySelector(".uvIndex").innerHTML = data.current.uv;
            let uvDescription;
            if(data.current.uv > 10){
                uvDescription = "Extreme";
            }
            else if(data.current.uv > 7){
                uvDescription = "Very High";
            }
            else if(data.current.uv > 5){
                uvDescription = "High";
            }
            else if(data.current.uv > 2){
                uvDescription = "Moderate";
            }
            else{
                uvDescription = "Low";
            }
            document.querySelector(".uvDesc").innerHTML = uvDescription;
        }




        function checkForAirQuality(){
                let airQualWord;
                if(data.current.air_quality["us-epa-index"] == "null"){
                    document.querySelector(".airQual").innerHTML = "Air Quality inforation is currently not available for this location";
                } 
                else{
                    switch(data.current.air_quality["us-epa-index"]){
                        case 1:
                            airQualWord = "Good";
                            break;
                        case 2:
                            airQualWord = "Moderate";
                            break;
                        case 3:
                            airQualWord = "Unhealthy for sensitive people";
                            break;
                        case 4:
                            airQualWord = "Unhealthy";
                            break;
                        case 5:
                            airQualWord = "Very Unhealthy";
                            break;
                        case 6:
                            airQualWord = "Hazardous";
                            break;
                        default:
                            airQualWord = "No info";
                    }
                    document.querySelector(".airDesc").innerHTML = airQualWord;
                    document.querySelector(".airNote").innerHTML = "Based on US EPA Standard";
                }
            
            /*Based on the US - EPA standard
            1 means Good (Green)
            2 means Moderate (Yellow)
            3 means Unhealthy for sensitive group (Orange)
            4 means Unhealthy (Red)
            5 means Very Unhealthy (Purple)
            6 means Hazardous (Maroon) */
        }


        function getSunriseTime(){
            //Save the sunrise time
            let sunriseTime = data.forecast.forecastday[0].astro.sunrise;
            const array2 = sunriseTime.split(" ");  
            sunriseTime = array2[0];    //remove the AM/PM portion will now look like "05:21" (sunriseTime is used by others)
            return sunriseTime;
        }

        function getSunriseHour(someTime){
            //get the sunrise hour
            const array3 = someTime.split(":")
            let sunriseHour = array3[0].replace(/^0+/,""); // looks like "5"  (sunriseHour is used by others)
            return sunriseHour;
        }

        function removeOldHourlyData(){
            /*Remove the old houly data, if there is one from a previous search*/
            const elements = document.getElementsByClassName("hour");
            while(elements.length > 0){
                elements[0].parentNode.removeChild(elements[0]);
            }
        }

        function removeOldThreeDayData(){
            /*Remove the old houly data, if there is one from a previous search*/
            const elements = document.getElementsByClassName("daily-weather");
            while(elements.length > 0){
                elements[0].parentNode.removeChild(elements[0]);
            }
        }

        function buildThreeDayWidget()
        {
            const weekday = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
            //create a date object using the date string value from json
            //Need to change from 2023-10-31 to 2023/10/31 to get correct date for some reason (might be javascript glitch or inconsistency)
            let dt = new Date(data.forecast.forecastday[0].date.replace(/-/g, '\/'));  

            document.querySelector(".daily-card").innerHTML += '<div class = "daily-weather"></div>';

            dayCounter = 0;
            let theDay;
            while(dayCounter < 3)
            {
                //Check if it's the first day, if so, set text to "Today"
                if(dayCounter == 0){
                    theDay = "Today";
                }
                else{
                    theDay = weekday[(dt.getDay() + dayCounter) % 7];
                }

                document.querySelector(".daily-weather").innerHTML +=  
                    '<div class="dayWeather">'+
                        '<div class = "dailycol1">'+
                            '<p class = "theDay">'+theDay+'</p>'+
                            '<img src='+data.forecast.forecastday[dayCounter].day.condition.icon+'>'+  
                        '</div>'+
                        '<div class = "dailycol2">'+    
                            '<p class="dayhigh">H: '+Math.round(data.forecast.forecastday[dayCounter].day.maxtemp_c)+'°</p>'+  
                            '<p class="daylow">L: '+Math.round(data.forecast.forecastday[dayCounter].day.mintemp_c)+'°</p>'+  
                        '</div>'+
                        '<div class = "dailycol3">'+                                     
                            '<p class="daypop">POP: '+data.forecast.forecastday[dayCounter].day.daily_chance_of_rain+'%</p>'+  
                            '<p class="dayprecip">'+Math.round(data.forecast.forecastday[dayCounter].day.totalprecip_mm)+' mm</p>'+
                        '</div>'+                                  
                    '</div>'+
                    '<p class="daily-condition">'+data.forecast.forecastday[dayCounter].day.condition.text +'</p>';
                
                //Make sure the last row does not print a horizontal rule <hr>
                if(dayCounter != 2){
                    document.querySelector(".daily-weather").innerHTML +=  '<hr><br>';
                }
                //Increment day counter
                dayCounter = dayCounter + 1;
            }
        }


        function buildSunriseWidget(){
            document.querySelector(".sunrise").innerHTML = sunriseTime; 
        }

        function buildSunsetWidget(){
            document.querySelector(".sunset").innerHTML = sunsetTime; 
        }

        function buildVisibilityWidget(){
            //Choose correct visibility descroption
            let visibility = data.current.vis_km;
            let description = "None";
            if(visibility < 3){
                description = "Poor visibility at the moment.";
            }
            else if(visibility < 6){
                description = "Fair visibility at the moment.";
            }
            else if(visibility < 10){
                description = "Clear visibility at the moment.";
            }
            else{
                description = "It's perfectly clear right now.";
            }
            document.querySelector(".visible-note").innerHTML = description;
        }









    }

    /*Event listener for clicking search button*/
    searchBtn.addEventListener("click", ()=>{
        checkWeather(searchBox.value);
    })

    /*Event listener for pressing the enter key*/
    searchBox.addEventListener("keypress", ()=>{
        if(event.key === "Enter"){
            checkWeather(searchBox.value);
        }
    })









</script>



</body>
</html>


<!--

Previous method storing data from json to arrays

    /*Instead of storing in array store each as an object*/
        /*try to store hourly temp data into a list */
        /*
        let dayOneTemps=[];
        for (let i = 0 ; i < 24 ; i++){
            dayOneTemps.push(data.forecast.forecastday[0].hour[i].temp_c) ;
        }

        let dayTwoTemps=[];
        for (let i = 0 ; i < 24 ; i++){
            dayTwoTemps.push(data.forecast.forecastday[1].hour[i].temp_c) ;
        }
        */
        /*Combine both arrays*/
        /*
        let _48HourTemps = dayOneTemps.concat(dayTwoTemps);
        */

        /*display the array*/
        /*document.getElementById("root").innerHTML = _48HourTemps.length; */









-->