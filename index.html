<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Don't use this in production: -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!--API KEY: 135f15ba9e1e49d3a64160722231710  -->
    <!--API URL: https://www.weatherapi.com/my/ -->


    <link rel="stylesheet" href="style.css">
    <script defer src="script.js"></script> <!--defer makes it execute after body-->

</head>

<body>
    <!--current-card is for current weather-->
    <div class = "current-card">

        <div class="search">
            <input type = "text" placeholder = "enter city name" spellcheck = "false"> <!--Search bar-->
            <button><img src="images2/search.png"></button> <!--search button-->
        </div>

        <div class="weather">
            <img id = "icon" src="images2/clear.png" class = "weather-icon"> <!--Current Weather image-->
            <h2 class="city">Location</h2>   <!--Current Weather location-->
            <p class="region">Region</p> <!--<p class="country">Country</p>-->
            <h1 class="temp">0°C</h1>    <!--Current weather temperature-->
            <h3 class="feel">Feels Like 0°C</h3>    <!--Feels like temperatur-->
            <h3 class="condition">Condition</h3>  <!--Current Condition-->
            <br>

            <!--Details for current weather-->
            <div class="details">
                <!--Column for humidity-->
                <div class="col">
                    <img src="images2/humidity.png">
                    <div>
                        <p class="humidity">0%</p>
                        <p>Humidity</p>
                    </div>
                </div>
                <!--Column for Wind-->
                <div class="col">
                    <img src="images2/wind.png">
                    <div>
                        <p class="wind">0 km/h</p>
                        <p>Wind Speed</p>
                    </div>
                </div>
                
            </div>

            <div class="details">
                <!--Column for sunrise-->
                <div class="col">
                    <img src="images2/sunrise.png">
                    <div>
                        <p class="sunrise">0:00 PM</p>
                        <p>Sunrise</p>
                    </div>
                </div>
                <!--Column for sunset-->
                <div class="col">
                    <img src="images2/sunset.png">
                    <div>
                        <p class="sunset">0:00 AM</p>
                        <p>Sunset</p>
                    </div>
                </div>
            </div>


        </div>

    </div>

    <div class="hourly-card">
        <h1>Hourly Forecast</h1>

        <div class="hourly-weather">


            
            
           

        </div>
    </div>

    <div class="root">

    </div>


    

<script>
    const apiURL = "https://api.weatherapi.com/v1/";
    const forecast = "forecast.json?";
    const key = "key=135f15ba9e1e49d3a64160722231710&q=";
    const days = "&days=3";
    const airQual = "&aqi=yes";
    const airData = "&agi=yes";
    const alerts = "&alerts=yes";


    const searchBox = document.querySelector(".search input");
    const searchBtn = document.querySelector(".search button");


    async function checkWeather(city){

        /*fetch 3 day weather data*/
        const response = await fetch(apiURL + forecast + key + city + days + airQual + alerts);
        var data = await response.json();

        console.log(data);

        /*Put current weather data into website elements*/
        document.getElementById("icon").src= data.current.condition.icon;
        document.querySelector(".city").innerHTML = data.location.name;
        document.querySelector(".region").innerHTML = data.location.region +" "+data.location.country;
        document.querySelector(".temp").innerHTML = Math.round(data.current.temp_c) + "°C";
        document.querySelector(".feel").innerHTML = "Feels Like " + Math.round(data.current.feelslike_c) + "°C";
        document.querySelector(".condition").innerHTML = data.current.condition.text;
        document.querySelector(".humidity").innerHTML = data.current.humidity + "%";
        document.querySelector(".wind").innerHTML = data.current.wind_kph + " km/h";
        document.querySelector(".sunrise").innerHTML = data.forecast.forecastday[0].astro.sunrise.replace(/^0+/,""); /*Remove begining 0's with replace(regex)*/
        document.querySelector(".sunset").innerHTML = data.forecast.forecastday[0].astro.sunset.replace(/^0+/,""); /*Remove begining 0's with replace(regex)*/

        /*Remove the old houly data, if there is one from a previous search*/
        const elements = document.getElementsByClassName("hour");
        while(elements.length > 0){
            elements[0].parentNode.removeChild(elements[0]);
        }

        let cityTime = data.location.localtime.substring(11, 13); //take the time date time from datapack and cut the hour portion
        let theTime = cityTime.replace(/^0+/,"");   //remove any leading 0's from the hour portion
        let theHour = Number(theTime);      //convert the string into a number

        console.log("the hour: "+theHour);
        //method that does not use the saved array

        let currentDay = 0;
        let counter = 0;


        
        while (counter < 24)
        {
            document.querySelector(".hourly-weather").innerHTML +=  
            
            '<div class="hour">'+

                '<p class=hourNum>'+theHour%24+"</p>"+ 
                                                                      
                '<img id = "hourIcon" src="images2/clear.png">'+
                                                                      
                '<p>'+Math.round(data.forecast.forecastday[currentDay].hour[theHour].temp_c); +'°</p>'+
                                                                      
            '</div>';
            if (theHour == 23){
                currentDay = 1;
                theHour = -1;
            }
            theHour = theHour + 1;
            counter = counter + 1;
            
        }
        
       /*is it possible to make an array of images*/
       /*Need to store the images src string into an array of string
       will probbably need two arays and them combine them*/
       /*new bug its using the array of data from the first city that was searched and puttiung the same hourly data on every other seaerch*/


        /*document.getElementById("hourIcon").src = data.forecast.forecastday[0].hour[i].condition.icon;*/
       
        /*https://9to5mac.com/2023/01/08/macos-ventura-weather-app/*/



        

        /*display the array*/
        /*document.getElementById("root").innerHTML = _48HourTemps.length; */

    }

    /*For hourly weather need to take the current time in that location, start at the next integer
    Or show the entire 24 hours and highlight the one youe currently on
    Steps
    1. Request forcast for 3 days (most allowed for free version)
    2. Get hourly for 24 hours
    3. store the hourly temp data into a list like const temps

    later get current time for that area
    */

    /*Event listener for clicking search button*/
    searchBtn.addEventListener("click", ()=>{
        checkWeather(searchBox.value);
    })

    /*Event listener for pressing the enter key*/
    searchBox.addEventListener("keypress", ()=>{
        if(event.key === "Enter"){
            checkWeather(searchBox.value);
        }
    })
</script>



    
</body>
</html>


<!--

Previous hour structure

        /*
            <div class="hour">
                <p>00</p>
                <img src="images2/clear.png">
                <p>0°</p>
            </div>
            
            <div class="hour">
                <p>01</p>
                <img src="images2/clear.png">
                <p>0°</p>
            </div>
        */

Previous method storing data from json to arrays

    /*Instead of storing in array store each as an object*/
        /*try to store hourly temp data into a list */
        /*
        let dayOneTemps=[];
        for (let i = 0 ; i < 24 ; i++){
            dayOneTemps.push(data.forecast.forecastday[0].hour[i].temp_c) ;
        }

        let dayTwoTemps=[];
        for (let i = 0 ; i < 24 ; i++){
            dayTwoTemps.push(data.forecast.forecastday[1].hour[i].temp_c) ;
        }
        */
        /*Combine both arrays*/
        /*
        let _48HourTemps = dayOneTemps.concat(dayTwoTemps);
        */









-->